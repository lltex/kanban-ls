<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kanban com Seletor de Cores Melhorado</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background-color: #f0f0f0;
    transition: background-color 0.3s ease;
  }
  header {
    padding: 1rem;
    background: #333;
    color: white;
    text-align: center;
  }
  .board {
    display: flex;
    gap: 1rem;
    padding: 1rem;
  }
  .column {
    background: white;
    border-radius: 6px;
    padding: 0.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .column-title {
    text-align: center;
    font-weight: bold;
    margin-bottom: 1rem;
  }
  .task {
    background: #ddd;
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    border-radius: 4px;
    position: relative;
    user-select: none;
  }
  .color-picker-btn {
    cursor: pointer;
    font-size: 1.4rem;
    margin-left: 0.5rem;
  }
  .color-picker-popup {
    position: absolute;
    z-index: 10;
    background: white;
    border: 1px solid #aaa;
    padding: 0.25rem;
    border-radius: 4px;
    display: none;
  }
  .color-picker-popup.active {
    display: block;
  }
  .color-picker-popup input[type=color] {
    cursor: pointer;
    border: none;
    padding: 0;
    width: 36px;
    height: 36px;
  }
  /* Seletor para o background */
  #backgroundColorPicker {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    background: white;
    padding: 0.5rem;
    border-radius: 8px;
    box-shadow: 0 0 6px rgba(0,0,0,0.2);
  }
  #backgroundColorPicker label {
    font-weight: bold;
    margin-right: 0.5rem;
  }
</style>
</head>
<body>

<header>
  <h1>Meu Kanban</h1>
</header>

<div class="board" id="board">
  <div class="column" data-column="todo">
    <div class="column-title">A Fazer</div>
    <div class="task" data-id="1" style="background-color: #f9c2c2;">
      Tarefa 1
      <span class="color-picker-btn" title="Alterar cor da tarefa" role="button" tabindex="0">ðŸŽ¨</span>
      <div class="color-picker-popup">
        <input type="color" />
      </div>
    </div>
    <div class="task" data-id="2" style="background-color: #c2f9c2;">
      Tarefa 2
      <span class="color-picker-btn" title="Alterar cor da tarefa" role="button" tabindex="0">ðŸŽ¨</span>
      <div class="color-picker-popup">
        <input type="color" />
      </div>
    </div>
  </div>
  <div class="column" data-column="doing">
    <div class="column-title">Fazendo</div>
    <div class="task" data-id="3" style="background-color: #c2c9f9;">
      Tarefa 3
      <span class="color-picker-btn" title="Alterar cor da tarefa" role="button" tabindex="0">ðŸŽ¨</span>
      <div class="color-picker-popup">
        <input type="color" />
      </div>
    </div>
  </div>
  <div class="column" data-column="done">
    <div class="column-title">ConcluÃ­do</div>
    <div class="task" data-id="4" style="background-color: #f9e2c2;">
      Tarefa 4
      <span class="color-picker-btn" title="Alterar cor da tarefa" role="button" tabindex="0">ðŸŽ¨</span>
      <div class="color-picker-popup">
        <input type="color" />
      </div>
    </div>
  </div>
</div>

<!-- Picker para alterar cor do fundo -->
<div id="backgroundColorPicker">
  <label for="bgColorInput">Fundo:</label>
  <input type="color" id="bgColorInput" value="#f0f0f0" />
</div>

<script>
  const board = document.getElementById('board');
  const bgColorInput = document.getElementById('bgColorInput');

  // Altera a cor do fundo do app
  bgColorInput.addEventListener('input', (e) => {
    document.body.style.backgroundColor = e.target.value;
  });

  // FunÃ§Ã£o para fechar todos os popups de cor
  function closeAllColorPickers() {
    document.querySelectorAll('.color-picker-popup.active').forEach(popup => {
      popup.classList.remove('active');
    });
  }

  // Abre o color picker quando clica no botÃ£o de pincel
  board.addEventListener('click', (e) => {
    if(e.target.classList.contains('color-picker-btn')) {
      e.stopPropagation();
      // Fecha outros popups
      closeAllColorPickers();

      const popup = e.target.nextElementSibling;
      if (popup) {
        popup.classList.toggle('active');
        // Atualiza o input color para a cor atual do card
        const inputColor = popup.querySelector('input[type=color]');
        const task = e.target.closest('.task');
        if(task && inputColor) {
          const bg = window.getComputedStyle(task).backgroundColor;
          // Converter RGB para HEX para setar input color
          inputColor.value = rgbToHex(bg);
        }
      }
    }
  });

  // Fecha o popup ao clicar fora
  document.body.addEventListener('click', () => {
    closeAllColorPickers();
  });

  // Altera a cor do card ao escolher a cor no input
  board.querySelectorAll('.color-picker-popup input[type=color]').forEach(input => {
    input.addEventListener('input', (e) => {
      const popup = e.target.closest('.color-picker-popup');
      const task = popup.previousElementSibling; // botÃ£o de cor, irmÃ£o antes do popup
      if(task) {
        // O task Ã© o botÃ£o, precisamos do elemento .task
        const taskDiv = task.closest('.task');
        if(taskDiv) {
          taskDiv.style.backgroundColor = e.target.value;
        }
      }
    });
  });

  // FunÃ§Ã£o para converter rgb(x,x,x) para hex
  function rgbToHex(rgb) {
    const result = /^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(rgb);
    if (!result) return '#ffffff';
    return "#" + 
      [1,2,3].map(i => {
        const hex = parseInt(result[i]).toString(16);
        return hex.length === 1 ? "0" + hex : hex;
      }).join('');
  }
</script>

</body>
</html>
